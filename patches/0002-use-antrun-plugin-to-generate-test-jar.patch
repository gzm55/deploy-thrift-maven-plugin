From 520e4c35507856c2d9f0dd3c9f8ce92c1f09845c Mon Sep 17 00:00:00 2001
From: "James Z.M. Gao" <gaozhiming@360.cn>
Date: Fri, 28 Jun 2019 00:00:56 +0800
Subject: [PATCH 2/5] use antrun plugin to generate test jar

---
 contrib/thrift-maven-plugin/pom.xml | 36 ++++++-----------------------
 1 file changed, 7 insertions(+), 29 deletions(-)

diff --git a/contrib/thrift-maven-plugin/pom.xml b/contrib/thrift-maven-plugin/pom.xml
index 524d7eeb..684678ee 100644
--- a/contrib/thrift-maven-plugin/pom.xml
+++ b/contrib/thrift-maven-plugin/pom.xml
@@ -51,42 +51,20 @@
       </plugin>
       <plugin>
         <groupId>org.apache.maven.plugins</groupId>
-        <artifactId>maven-jar-plugin</artifactId>
-        <version>3.1.2</version>
+        <artifactId>maven-antrun-plugin</artifactId>
+        <version>1.8</version>
         <executions>
           <execution>
             <id>generate-jar-for-test</id>
-            <phase>process-test-classes</phase>
-            <goals>
-              <goal>test-jar</goal>
-            </goals>
+            <phase>generate-test-resources</phase>
             <configuration>
-              <classifier>idl</classifier>
-              <excludes>
-                <exclude>**/*.class</exclude>
-              </excludes>
-              <includes>
-                <include>**/*.thrift</include>
-              </includes>
+              <target>
+                <jar destfile="${project.build.directory}/SharedIdl.jar" basedir="${basedir}/src/test/resources" includes="**/*.thrift" />
+              </target>
             </configuration>
-          </execution>
-        </executions>
-      </plugin>
-      <plugin>
-        <groupId>com.coderplus.maven.plugins</groupId>
-        <artifactId>copy-rename-maven-plugin</artifactId>
-        <version>1.0</version>
-        <executions>
-          <execution>
-            <id>rename-jar-for-test</id>
-            <phase>process-test-classes</phase>
             <goals>
-              <goal>rename</goal>
+              <goal>run</goal>
             </goals>
-            <configuration>
-              <sourceFile>${project.build.directory}/${project.artifactId}-${project.version}-idl.jar</sourceFile>
-              <destinationFile>${project.build.directory}/SharedIdl.jar</destinationFile>
-            </configuration>
           </execution>
         </executions>
       </plugin>
-- 
2.22.0

